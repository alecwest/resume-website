<clr-main-container>
  <clr-header class="header header-3">
    <div class="branding">
      <a href="/" class="nav-link">
        <clr-icon shape="flame"></clr-icon>
        <clr-spinner clrInline *ngIf="loading; else nameHeader"></clr-spinner>
        <ng-template #nameHeader>
          <span class="title">{{ name | async }}</span>
        </ng-template>
      </a>
    </div>
    <div class="header-actions" *ngIf="!loading">
      <a
        [href]="resume"
        target="_blank"
        class="nav-link tooltip tooltip-sm tooltip-bottom-left"
        role="tooltip"
        aria-haspopup="true"
      >
        <clr-icon shape="file"></clr-icon>
        <span class="tooltip-content">View my Resume</span>
      </a>
    </div>
  </clr-header>

  <nav class="subnav" [clr-nav-level]="1">
    <ul class="nav">
      <li class="nav-item" *ngIf="loading; else navLinks">
        <clr-spinner clrInline>Loading...</clr-spinner>
      </li>
      <ng-template #navLinks>
        <li class="nav-item" *ngFor="let sheet of getTableSheets()">
          <a class="nav-link" href="#{{ sheet.metadata.header }}">{{
            sheet.metadata.header
          }}</a>
        </li>
      </ng-template>
    </ul>
  </nav>

  <div class="content-container">
    <div class="content-area">
      <div class="clr-row loading" *ngIf="loading; else dataCards">
        <clr-spinner></clr-spinner>
      </div>
      <ng-template #dataCards>
        <!-- Card Style Data -->
        <ng-container *ngIf="(entryLayout | async) as layouts">
          <div
            class="clr-row fullscreen"
            id="{{type}}-entries"
            *ngFor="let type of entryTypes | async;"
          >
            <div class="clr-col-lg-8 clr-offset-lg-2 clr-col-12" *ngIf="(entriesByType$ | async) as entriesByType">
              <div class="card center-vertical">
                <div class="card-header">
                  {{ type | titlecase }}
                </div>
                <div class="card-block">
                  <div class="card-text">
                    <ng-container [ngSwitch]="layouts[type]">
                      <app-bio *ngSwitchCase="'headerCard'" [bio]="entriesByType[type][0]"></app-bio>
                      <app-datagrid *ngSwitchCase="'newDataGrid'" [resumeEntries]="entriesByType[type]"></app-datagrid>
                      <app-rank *ngSwitchCase="'list'" [resumeEntries]="entriesByType[type]"></app-rank>
                      <p *ngSwitchDefault>WIP</p>
                    </ng-container>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </ng-template>
    </div>
  </div>

  <ng-template #iconGrid let-sheet>
    <div class="clr-row">
      <ng-container *ngFor="let row of getDataRows(sheet); let i = index">
        <div class="clr-col icon-grid-content">
          <h4>{{ row[getColumnNames(sheet)[0]] | titlecase }}</h4>
          <img
            class="icon-grid-image"
            [src]="row[getColumnNames(sheet)[1]]"
            [alt]="row[getColumnNames(sheet)[2]]"
          />
        </div>
        <div class="clr-break-row" *ngIf="i % 3 === 2"></div>
      </ng-container>
    </div>
  </ng-template>

  <ng-template #table let-sheet>
    <table class="table">
      <thead>
        <tr>
          <th *ngFor="let columnName of getColumnNames(sheet)">
            {{ columnName | viewFriendly | titlecase }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of getDataRows(sheet)">
          <td *ngFor="let columnName of getColumnNames(sheet)">
            <ng-container *ngTemplateOutlet="text; context: { $implicit: row[columnName] }"></ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-template>

  <ng-template #verticalTable let-sheet>
    <table class="table table-vertical">
      <tbody>
        <tr *ngFor="let columnName of getColumnNames(sheet)">
          <th>
            {{ columnName | viewFriendly | titlecase }}
          </th>
          <td>
            <ng-container *ngTemplateOutlet="text; context: sheet.values[0][columnName]"></ng-container>
          </td>
        </tr>
      </tbody>
    </table>
  </ng-template>

  <ng-template #text let-context>
    <app-text [context]="context"></app-text>
  </ng-template>
</clr-main-container>
